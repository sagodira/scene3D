<html>
  <head>
    <script src="https://aframe.io/releases/1.6.0/aframe.min.js"></script>
    <script src="https://unpkg.com/aframe-environment-component/dist/aframe-environment-component.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/c-frame/aframe-extras@7.5.4/dist/aframe-extras.min.js"></script>
  </head>
  <body>
    <a-scene>
      <a-assets>
        <a-asset-item id="moto" src="assets/moto.glb"></a-asset-item>
        <a-asset-item id="fog" src="assets/fog.glb"></a-asset-item>
        <a-asset-item id="road" src="assets/road.glb"></a-asset-item>
      </a-assets>

      <!-- Caméra (libre pour explorer la scène) -->
      <a-entity id="rig" movement-controls position="0 3 120">
        <a-entity
          camera
          position="0 1.6 0"
          look-controls="pointerLockEnabled: true"
          cursor="rayOrigin: mouse"
        ></a-entity>
        <a-entity
          oculus-touch-controls="hand: left"
          laser-controls="hand: left"
          raycaster="objects: .clickable; far: 10; showLine: true"
        ></a-entity>
        <a-entity
          oculus-touch-controls="hand: right"
          laser-controls="hand: right"
          raycaster="objects: .clickable; far: 10; showLine: true"
        ></a-entity>
      </a-entity>

      <!-- Moto positionnée pour le Akira Slide -->
      <a-entity
        gltf-model="assets/moto.glb"
        position="0 0 93.474"
        scale="0.5 0.5 0.5"
        rotation="0 -90 0"
        class="clickable"
        id="moto"
      ></a-entity>

      <a-entity gltf-model="#road"></a-entity>

      <a-sky src="/assets/akira.jpg" position="0 300 0" rotation="0 -70 0"></a-sky>

      <script>
        // Ajouter un composant personnalisé pour monter sur la moto
        AFRAME.registerComponent("ride-moto", {
          init: function () {
            const el = this.el; // Référence à l'élément (la moto)
            const rig = document.querySelector("#rig"); // Référence au rig (caméra + contrôles)

            el.addEventListener("click", function () {
              // Repositionner le rig sur la moto
              rig.setAttribute("position", {
                x: 0,
                y: 1.5, // Hauteur de la caméra par rapport à la moto
                z: 93.474, // Position de la moto
              });
              // Optionnel : verrouiller le mouvement de la caméra une fois sur la moto
              rig.removeAttribute("movement-controls");
            });
          },
        });

        // Appliquer le composant à la moto
        document
          .querySelector("#moto")
          .setAttribute("ride-moto", ""); // Activer le script sur la moto
      </script>
    </a-scene>
  </body>
</html>
